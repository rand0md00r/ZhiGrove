name: Content Statistics Report

on:
  schedule: [{ cron: "0 3 * * 0" }]  # æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  generate-stats:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      - name: Generate Statistics Report
        run: |
          echo "ğŸ“Š å¼€å§‹ç”Ÿæˆå†…å®¹ç»Ÿè®¡æŠ¥å‘Š..."
          
          # åˆ›å»ºæŠ¥å‘Šæ–‡ä»¶
          cat > content-stats.md << 'EOF'
          # ğŸ“Š çŸ¥è¯†åº“å†…å®¹ç»Ÿè®¡æŠ¥å‘Š
          
          > ç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')
          
          ## ğŸ“ æ–‡ä»¶ç»Ÿè®¡
          
          EOF
          
          # ç»Ÿè®¡å„ç›®å½•æ–‡ä»¶æ•°é‡
          echo "### ğŸ“¥ æ”¶ä»¶ç®± (00-inbox)" >> content-stats.md
          inbox_count=$(find ./00-inbox -name "*.md" -type f | wc -l)
          echo "- æ–‡ä»¶æ•°é‡: **$inbox_count**" >> content-stats.md
          if [ $inbox_count -gt 15 ]; then
            echo "- çŠ¶æ€: âš ï¸ éœ€è¦æ•´ç†" >> content-stats.md
          elif [ $inbox_count -gt 10 ]; then
            echo "- çŠ¶æ€: ğŸŸ¡ å»ºè®®æ•´ç†" >> content-stats.md
          else
            echo "- çŠ¶æ€: âœ… çŠ¶æ€è‰¯å¥½" >> content-stats.md
          fi
          echo "" >> content-stats.md
          
          echo "### ğŸ“š çŸ¥è¯†åº“ (10-knowledge)" >> content-stats.md
          knowledge_count=$(find ./10-knowledge -name "*.md" -type f | wc -l)
          echo "- æ–‡ä»¶æ•°é‡: **$knowledge_count**" >> content-stats.md
          if [ $knowledge_count -lt 3 ]; then
            echo "- çŠ¶æ€: âš ï¸ å†…å®¹è¾ƒå°‘" >> content-stats.md
          elif [ $knowledge_count -lt 10 ]; then
            echo "- çŠ¶æ€: ğŸŸ¡ å»ºè®®å¢åŠ " >> content-stats.md
          else
            echo "- çŠ¶æ€: âœ… å†…å®¹ä¸°å¯Œ" >> content-stats.md
          fi
          echo "" >> content-stats.md
          
          echo "### ğŸ“„ è®ºæ–‡ç¬”è®° (20-papers)" >> content-stats.md
          papers_count=$(find ./20-papers -name "*.md" -type f | wc -l)
          echo "- æ–‡ä»¶æ•°é‡: **$papers_count**" >> content-stats.md
          echo "" >> content-stats.md
          
          echo "### ğŸ’¡ æƒ³æ³•è®°å½• (30-ideas)" >> content-stats.md
          ideas_count=$(find ./30-ideas -name "*.md" -type f | wc -l)
          echo "- æ–‡ä»¶æ•°é‡: **$ideas_count**" >> content-stats.md
          echo "" >> content-stats.md
          
          echo "### ğŸ”¬ å®éªŒè®°å½• (40-experiments)" >> content-stats.md
          exp_count=$(find ./40-experiments -name "*.md" -type f | wc -l)
          echo "- æ–‡ä»¶æ•°é‡: **$exp_count**" >> content-stats.md
          echo "" >> content-stats.md
          
          echo "### ğŸ“Š æŠ¥å‘Š (50-reports)" >> content-stats.md
          reports_count=$(find ./50-reports -name "*.md" -type f | wc -l)
          echo "- æ–‡ä»¶æ•°é‡: **$reports_count**" >> content-stats.md
          echo "" >> content-stats.md
          
          # è®¡ç®—æ€»è®¡
          total_files=$((inbox_count + knowledge_count + papers_count + ideas_count + exp_count + reports_count))
          echo "## ğŸ¯ æ€»ä½“ç»Ÿè®¡" >> content-stats.md
          echo "- **æ€»æ–‡ä»¶æ•°: $total_files**" >> content-stats.md
          echo "- æ”¶ä»¶ç®±å æ¯”: $((inbox_count * 100 / total_files))%" >> content-stats.md
          echo "- çŸ¥è¯†åº“å æ¯”: $((knowledge_count * 100 / total_files))%" >> content-stats.md
          echo "" >> content-stats.md
          
          # æ·»åŠ å»ºè®®
          echo "## ğŸ’¡ æœ¬å‘¨å»ºè®®" >> content-stats.md
          if [ $inbox_count -gt 15 ]; then
            echo "- ğŸš¨ **ä¼˜å…ˆæ•´ç†æ”¶ä»¶ç®±**ï¼Œæ¸…ç†è¶…è¿‡15ä¸ªæ–‡ä»¶" >> content-stats.md
          fi
          if [ $knowledge_count -lt 5 ]; then
            echo "- ğŸ“š **å¢åŠ çŸ¥è¯†æ²‰æ·€**ï¼Œæ•´ç†å·²æœ‰å†…å®¹åˆ°çŸ¥è¯†åº“" >> content-stats.md
          fi
          if [ $papers_count -eq 0 ]; then
            echo "- ğŸ“„ **å¼€å§‹è®ºæ–‡å­¦ä¹ **ï¼Œè®°å½•è®ºæ–‡ç¬”è®°" >> content-stats.md
          fi
          if [ $ideas_count -lt 3 ]; then
            echo "- ğŸ’¡ **è®°å½•æƒ³æ³•çµæ„Ÿ**ï¼Œä¿æŒåˆ›æ–°æ€ç»´" >> content-stats.md
          fi
          if [ $exp_count -eq 0 ]; then
            echo "- ğŸ”¬ **è®°å½•å®éªŒè¿‡ç¨‹**ï¼Œç§¯ç´¯å®è·µç»éªŒ" >> content-stats.md
          fi
          echo "" >> content-stats.md
          
          echo "---" >> content-stats.md
          echo "*æ­¤æŠ¥å‘Šç”±GitHub Actionsè‡ªåŠ¨ç”Ÿæˆï¼Œæ¯å‘¨æ—¥æ›´æ–°*" >> content-stats.md
          
          echo "âœ… ç»Ÿè®¡æŠ¥å‘Šç”Ÿæˆå®Œæˆ"
      
      - name: Upload Report
        uses: actions/upload-artifact@v3
        with:
          name: content-stats
          path: content-stats.md
      
      - name: Display Report
        run: |
          echo "ğŸ“Š å†…å®¹ç»Ÿè®¡æŠ¥å‘Šé¢„è§ˆ:"
          echo "=================="
          cat content-stats.md
