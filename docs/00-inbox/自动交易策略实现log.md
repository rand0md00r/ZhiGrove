自动交易策略流程图：

1. 读取MongoDB篮子股票信息；
2. 计算每个股票的买单信息：按价格买入（1102），计算买入价格（竞价末尾位置的1.02，向下取整）；
3. 挂单；
4. 检查委托列表，判断是否成功挂单；
5. 检查买入列表，判断是否成功买入；

6. 卖出逻辑：第二天早盘9：30开始挂出卖单，按开盘价格 * 1.091卖出；下午2:55检查是否完成卖出，如果没卖出，撤单，2:57尾盘竞价开始时，挂跌停价卖出；



--- 
# 11月12日 问题

1. 27:00 查询到的数据是错误的个股；
2. buy_price错误，

## 日志

[2025-11-13 09:08:12][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-11-13 09:08:12][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-11-13 09:08:12
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 最大买入股票：5只
================================================================================

[2025-11-13 09:28:06][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-13 09:28:06（重试1/18）

[2025-11-13 09:28:06][新建策略文件][SH000300][1分钟]  获取今日股票篮子：['002451.SZ', '000973.SZ']（共2只）

【资金查询】账号：904800028165
? 可用资金：10000.00元
? 单只股票可用资金：4985.00元（含手续费预留）

【竞价价查询】股票：002451.SZ
? 竞价价查询异常：name 'tick_data' is not defined

【竞价价查询】股票：000973.SZ
? 竞价价查询异常：name 'tick_data' is not defined
?? 无有效买入参数，终止交易

[2025-11-13 09:29:13][新建策略文件][SH000300][1分钟] 0D:\国投核心客户极速策略交易终端（ACT）\python\新建策略文件.py_00030013: 策略停止
[2025-11-13 09:29:13][新建策略文件][SH000300][1分钟] 
================================================================================
【策略停止】时间：2025-11-13 09:29:13
今日交易状态：已执行买入操作
建议：登录QMT交易模块，查看「委托记录」和「持仓」确认最终状态
================================================================================

[2025-11-13 09:30:11][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-11-13 09:30:11][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-11-13 09:30:11
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 最大买入股票：5只
================================================================================

[2025-11-13 09:30:25][新建策略文件][SH000300][1分钟] 0D:\国投核心客户极速策略交易终端（ACT）\python\新建策略文件.py_00030024: 策略停止
[2025-11-13 09:30:25][新建策略文件][SH000300][1分钟] 
================================================================================
【策略停止】时间：2025-11-13 09:30:25
今日交易状态：未执行交易
建议：登录QMT交易模块，查看「委托记录」和「持仓」确认最终状态
================================================================================

[2025-11-13 09:31:01][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-11-13 09:31:01][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-11-13 09:31:01
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 最大买入股票：5只
================================================================================

【MongoDB查询】时间：2025-11-13 09:31:01（重试1/18）

[2025-11-13 09:31:01][新建策略文件][SH000300][1分钟]  获取今日股票篮子：['300497.SZ']（共1只）

【资金查询】账号：904800028165
? 可用资金：10000.00元
? 单只股票可用资金：9970.00元（含手续费预留）

【竞价价查询】股票：300497.SZ
集合竞价数据-300497.SZ：开盘价=17.01, 最新价=17.5 成交量=202298, 成交额=350095000.0
? 集合竞价价格：17.01元
? 买入参数：300497.SZ | 价格17.35元 | 500手（50000股）

【挂单操作】股票：300497.SZ
market_code: 2
float(lots): 500.0
?? 挂单请求发送成功：300497.SZ | 价格17.35元 | 500手

[2025-11-13 09:31:04][新建策略文件][SH000300][1分钟] 
【委托状态检查】股票：300497.SZ
?? 未找到目标委托，当前所有委托：
? 委托状态查询异常：'COrderDetail' object has no attribute 'm_strOrderCode'

[2025-11-13 09:31:05][新建策略文件][SH000300][1分钟] 
? 所有股票买入操作已完成


##################################################################################################################

--- 

# 11月13日

## 问题：
1. 买入：千尾；
2. 卖出：千竞 = 涨停价格 * 0.97，向下取整； 千尾 = 涨停价格 * 0.91，向上取整； 没涨停，尾盘直接卖出；
3. 买入的有效检查 = 查委托 + 查持仓；
4. 卖出逻辑：第二天早盘9：30开始挂出卖单，按涨停价格 * 0.91卖出；下午2:55检查是否完成卖出，如果没卖出，撤单，2:57尾盘竞价开始时，挂跌停价卖出；

## 日志：

[2025-11-14 09:17:57][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-11-14 09:17:57][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-11-14 09:17:57
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 卖出规则：次日9:30涨停价×0.91挂单，14:55未卖撤单，14:57跌停价卖出
================================================================================

[2025-11-14 09:28:04][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-14 09:28:04（重试1/18）

[2025-11-14 09:28:04][新建策略文件][SH000300][1分钟]  获取今日股票篮子：['000572.SZ', '000688.SZ']（共2只）

【资金查询】账号：904800028165
 可用资金：9999.00元
 单只股票可用资金：4984.50元（含手续费预留）

【竞价价格查询】股票：000572.SZ
集合竞价数据-000572.SZ：开盘价=10.5, 最新价=10.5 成交量=146411, 成交额=153731600.0
 集合竞价价格：10.50元
 买入参数：000572.SZ | 价格10.71元 | 400手（40000股）

【竞价价格查询】股票：000688.SZ
集合竞价数据-000688.SZ：开盘价=25.0, 最新价=25.0 成交量=17923, 成交额=44808400.0
 集合竞价价格：25.00元
 买入参数：000688.SZ | 价格25.50元 | 100手（10000股）

【挂单操作】股票：000572.SZ
market_code: 2
float(lots): 400.0
 挂单请求发送成功：000572.SZ | 价格10.71元 | 400手

[2025-11-14 09:28:07][新建策略文件][SH000300][1分钟] 
【委托状态检查】股票：000572.SZ
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM853127
 委托校验通过 | 委托ID=MM853127 | 状态=已报（等待成交） | 股票=000572 | 价格=10.71元 | 手数=400

【持仓状态检查】股票：000572.SZ
 未查询到持仓记录

[2025-11-14 09:28:08][新建策略文件][SH000300][1分钟] 
【挂单操作】股票：000688.SZ
market_code: 2
float(lots): 100.0
 挂单请求发送成功：000688.SZ | 价格25.50元 | 100手

[2025-11-14 09:28:11][新建策略文件][SH000300][1分钟] 
【委托状态检查】股票：000688.SZ
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM853131
 委托校验通过 | 委托ID=MM853131 | 状态=已报（等待成交） | 股票=000688 | 价格=25.50元 | 手数=100

【持仓状态检查】股票：000688.SZ
 未查询到持仓记录

[2025-11-14 09:28:12][新建策略文件][SH000300][1分钟] 
 所有股票买入操作已完成



---

# 11月17日 

## 日志：

[2025-11-17 09:11:03][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-11-17 09:11:03][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-11-17 09:11:03
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 卖出规则：次日9:30涨停价×0.91挂单，14:55未卖撤单，14:57跌停价卖出
================================================================================

[2025-11-17 09:28:00][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-17 09:28:00（重试1/18）

[2025-11-17 09:28:00][新建策略文件][SH000300][1分钟] 警告：未找到今日（2025-11-17）有效股票篮子，10秒后重试

[2025-11-17 09:28:10][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-17 09:28:10（重试2/18）

[2025-11-17 09:28:10][新建策略文件][SH000300][1分钟] 警告：未找到今日（2025-11-17）有效股票篮子，10秒后重试

[2025-11-17 09:28:20][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-17 09:28:20（重试3/18）

[2025-11-17 09:28:20][新建策略文件][SH000300][1分钟] 警告：未找到今日（2025-11-17）有效股票篮子，10秒后重试

[2025-11-17 09:28:30][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-17 09:28:30（重试4/18）

[2025-11-17 09:28:30][新建策略文件][SH000300][1分钟]  获取今日股票篮子：['603931.SH']（共1只）

【资金查询】账号：904800028165
 可用资金：13209.35元
 单只股票可用资金：13169.72元（含手续费预留）

【竞价价格查询】股票：603931.SH
集合竞价数据-603931.SH：开盘价=32.0, 最新价=32.0 成交量=4901, 成交额=15683200.0
 集合竞价价格：32.00元
 买入参数：603931.SH | 价格32.64元 | 400手（40000股）

【挂单操作】股票：603931.SH
market_code: 1
float(lots): 400.0
 挂单请求发送成功：603931.SH | 价格32.64元 | 400手

[2025-11-17 09:28:33][新建策略文件][SH000300][1分钟] 
【委托状态检查】股票：603931.SH
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM567559
 委托校验通过 | 委托ID=MM567559 | 状态=已报（等待成交） | 股票=603931 | 价格=32.64元 | 手数=400

【持仓状态检查】股票：603931.SH
 未找到目标持仓

[2025-11-17 09:28:34][新建策略文件][SH000300][1分钟] 
 所有股票买入操作已完成


## 问题：
1. 分成两个账号轮流交易，每次记录两个分仓的信息；
2. 卖出价格是开盘价的1.091，不是涨停价的0.91
3. 持仓信息不能用代码中的函数记录，因为每天代码会被关闭，只有早上快开盘的时候才开始运行，所以持仓信息需要直接查询
4. mongoDB股票信息刷新错误，最后一次更新在update_time 2025-11-17T09:32:32.473+00:00



---

# 11月18日
 
## 日志：

[2025-11-18 09:21:23][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-11-18 09:21:23][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-11-18 09:21:23
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 卖出规则：次日9:30开盘价×1.091挂单，14:55未卖撤单，14:57跌停价卖出
================================================================================

[2025-11-18 09:28:01][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-18 09:28:01（重试1/18）

[2025-11-18 09:28:01][新建策略文件][SH000300][1分钟]  获取今日股票篮子：['600829.SH', '000636.SZ']（共2只）

【资金查询】账号：904800028165
 可用资金：7417.83元
 单只股票可用资金：3697.79元（含手续费预留）

【竞价价格查询】股票：600829.SH
集合竞价数据-600829.SH：开盘价=16.7, 最新价=16.7 成交量=51102, 成交额=85340500.0
 集合竞价价格：16.70元
 买入参数：600829.SH | 价格17.03元 | 200手（20000股）

【竞价价格查询】股票：000636.SZ
集合竞价数据-000636.SZ：开盘价=17.830000000000002, 最新价=17.830000000000002 成交量=24239, 成交额=43218100.0
 集合竞价价格：17.83元
 买入参数：000636.SZ | 价格18.18元 | 200手（20000股）

【挂单操作】股票：600829.SH
market_code: 1
float(lots): 200.0
 挂单请求发送成功：600829.SH | 价格17.03元 | 200手

[2025-11-18 09:28:04][新建策略文件][SH000300][1分钟] 
【委托状态检查】股票：600829.SH
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM575061
 委托校验通过 | 委托ID=MM575061 | 状态=已报（等待成交） | 股票=600829 | 价格=17.03元 | 手数=200

【持仓状态检查】股票：600829.SH
 未找到目标持仓

[2025-11-18 09:28:05][新建策略文件][SH000300][1分钟] 
【挂单操作】股票：000636.SZ
market_code: 2
float(lots): 200.0
 挂单请求发送成功：000636.SZ | 价格18.18元 | 200手

[2025-11-18 09:28:08][新建策略文件][SH000300][1分钟] 
【委托状态检查】股票：000636.SZ
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM872166
 委托校验通过 | 委托ID=MM872166 | 状态=已报（等待成交） | 股票=000636 | 价格=18.18元 | 手数=200

【持仓状态检查】股票：000636.SZ
 未找到目标持仓

[2025-11-18 09:28:09][新建策略文件][SH000300][1分钟] 
 所有股票买入操作已完成

[2025-11-18 09:30:00][新建策略文件][SH000300][1分钟] 
【早盘卖出】时间窗口触发（09:30:00）

【查询当前持仓】账号：904800028165
 当前持仓：['603931.SH']（共1只）

【卖出挂单】股票：603931.SH | 价格=33.16元 | 手数=4
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM872166
 卖出挂单成功 | 委托ID=MM872166
【早盘卖出】批量挂单完成，等待成交

[2025-11-18 09:31:00][新建策略文件][SH000300][1分钟] 
【早盘成交监控】时间：09:31:00（每30秒检查一次）

【查询当前持仓】账号：904800028165
 当前持仓：['600829.SH', '603931.SH']（共2只）

## 问题：
1. 股池读取错误，改为9:28再读取； 
2. 卖出挂单失败，需要debug，当前日志中显示只卖出了2股，可能是代码计算的手数当成了卖出的股数，改为以股数卖出。 
3. check_position_status 函数debug功能； 
4. 第二天卖出的时间改为9:26挂卖出单； 
5. 去除全天监控是否卖出的逻辑，只在尾盘竞价前执行检查卖出情况和撤单逻辑；

6. 次日判断（只挂前一天买入的票）；
7. 撤单功能：14:55 直接查询全部委托列表，按「当前持仓代码 + 状态=未成/部成」来撤单

---

# 11月19日 

## 日志：

[2025-11-19 09:40:37][新建策略文件][SH000300][1分钟] 0D:\国投核心客户极速策略交易终端（ACT）\python\新建策略文件.py_000300129: 策略停止
[2025-11-19 09:40:38][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-11-19 09:40:38][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-11-19 09:40:38
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 卖出规则：次日9:30开盘价×1.091挂单，14:55未卖撤单，14:57跌停价卖出
================================================================================

[2025-11-19 09:40:38][新建策略文件][SH000300][1分钟] 
========================================
早盘卖出流程启动  时间：09:40:38
========================================

【查询当前持仓】账号：904800028165
 当前持仓：['600829.SH', '002083.SZ']（共2只）
【早盘卖出】600829.SH 基准价=17.72 * 1.091 -> 卖出价=19.33元

【卖出挂单】股票：600829.SH | 价格=19.33元 | 股数=200
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM583426
 卖出挂单成功 | 委托ID=MM583426
【早盘卖出】002083.SZ 基准价=12.46 * 1.091 -> 卖出价=13.59元

【卖出挂单】股票：002083.SZ | 价格=13.59元 | 股数=600
【获取最新委托ID】账号：904800028165

[2025-11-19 09:40:38][新建策略文件][SH000300][1分钟]  成功获取最新委托ID：MM583426
 卖出挂单成功 | 委托ID=MM583426
【早盘卖出】批量挂单结束

## 问题：

1. 卖出价格应该基于last close计算涨停价格，而不是开盘价。（已修复）
2. 9:28 买入时，MongoDB数据依然错误，直到29:xx，才买入新股；
3. *卖出撤单失败，测试撤单


order 字段：['-1', '0', '1', '101', '107', '108', '109', '110', '111', '112', '113', '114', '2', '255', '32', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '66', '67', '68', '69', '70', '71', '72', '73', '75', '77', '78', '79', '80', '81', '83', '84', '85', '86', '87', '88', '89', '90', '91', '92', '93', '94', 'EBrokerPriceType', 'ECoveredFlag', 'EEntrustBS', 'EEntrustStatus', 'EEntrustSubmitStatus', 'EEntrustTypes', 'EFutureTradeType', 'EHedge_Flag_Type', 'EOffset_Flag_Type', 'ESideFlag', 'EXTCompactBrushSource', 'EXTCompactStatus', 'EXTCompactType', 'EXTSloTypeQueryMode', 'EXTSubjectsStatus', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__instance_size__', '__le__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', 'j', 'm_bEnable', 'm_dCancelAmount', 'm_dFrozenCommission', 'm_dFrozenMargin', 'm_dLimitPrice', 'm_dOrderPriceRMB', 'm_dReferenceRate', 'm_dShortOccupedMargin', 'm_dTradeAmount', 'm_dTradeAmountRMB', 'm_dTradedPrice', 'm_eCashgroupProp', 'm_eCoveredFlag', 'm_eEntrustType', 'm_nDirection', 'm_nErrorID', 'm_nFrontID', 'm_nGroupId', 'm_nHedgeFlag', 'm_nOffsetFlag', 'm_nOpType', 'm_nOrderPriceType', 'm_nOrderStatus', 'm_nOrderStrategyType', 'm_nOrderSubmitStatus', 'm_nRef', 'm_nSessionID', 'm_nStrategyID', 'm_nTaskId', 'm_nVolumeTotal', 'm_nVolumeTotalOriginal', 'm_nVolumeTraded', 'm_strAccountID', 'm_strAccountKey', 'm_strAccountName', 'm_strAccountRemark', 'm_strBrokerName', 'm_strCancelInfo', 'm_strCompactNo', 'm_strErrorMsg', 'm_strExchangeID', 'm_strExchangeName', 'm_strInsertDate', 'm_strInsertTime', 'm_strInstrumentID', 'm_strInstrumentName', 'm_strLocalInfo', 'm_strOptName', 'm_strOption', 'm_strOrderParam', 'm_strOrderRef', 'm_strOrderStrategyType', 'm_strOrderSysID', 'm_strProductID', 'm_strProductName', 'm_strRemark', 'm_strSource', 'm_strUnderCode', 'm_strXTTrade', 'm_xtTag', 'w', 'x', 'y', 'z']


order.m_nDirection:48
order.m_strOptName:限价卖出
order.m_nOrderStatus:54
order.m_strOrderSysID:MM582811


---

# 11月20日

## 日志：


[2025-11-20 09:06:00][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-11-20 09:06:00][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-11-20 09:06:00
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 卖出规则：次日9:30开盘价×1.091挂单，14:55未卖撤单，14:57跌停价卖出
================================================================================

[2025-11-20 09:28:01][新建策略文件][SH000300][1分钟] 
========================================
竞价买入流程启动  时间：09:28:01
========================================

【MongoDB查询】时间：2025-11-20 09:28:01（重试1/18）

[2025-11-20 09:28:01][新建策略文件][SH000300][1分钟]  获取今日股票篮子：['001216.SZ', '000632.SZ', '002474.SZ']（共3只）

【资金查询】账号：904800028165
 可用资金：9086.65元
 单只股票可用资金：3019.80元（含手续费预留）

【竞价价格查询】股票：001216.SZ
集合竞价数据-001216.SZ：开盘价=22.150000000000002, 最新价=22.150000000000002 成交量=48574, 成交额=107591400.0
 集合竞价价格：22.15元
 买入参数：001216.SZ | 价格22.59元 | 100股

【竞价价格查询】股票：000632.SZ
集合竞价数据-000632.SZ：开盘价=6.8, 最新价=6.8 成交量=551931, 成交额=375313200.0
 集合竞价价格：6.80元
 买入参数：000632.SZ | 价格6.93元 | 400股

【竞价价格查询】股票：002474.SZ
集合竞价数据-002474.SZ：开盘价=11.1, 最新价=11.1 成交量=96660, 成交额=107292600.0
 集合竞价价格：11.10元
 买入参数：002474.SZ | 价格11.32元 | 200股

[买入流程] 001216.SZ | 目标价=22.59 | lots=100

【挂单操作】股票：001216.SZ
 挂单请求发送成功：001216.SZ | 价格22.59元 | 100手

[2025-11-20 09:28:04][新建策略文件][SH000300][1分钟] 
【委托状态检查】股票：001216.SZ
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM889936
 委托校验通过 | 委托ID=MM889936 | 状态=已报（等待成交） | 股票=001216 | 价格=22.59元 | 手数=100

【持仓状态检查】股票：001216.SZ
 未找到目标持仓

[2025-11-20 09:28:05][新建策略文件][SH000300][1分钟] 
[买入流程] 000632.SZ | 目标价=6.93 | lots=400

【挂单操作】股票：000632.SZ
 挂单请求发送成功：000632.SZ | 价格6.93元 | 400手

[2025-11-20 09:28:08][新建策略文件][SH000300][1分钟] 
【委托状态检查】股票：000632.SZ
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM889938
 委托校验通过 | 委托ID=MM889938 | 状态=已报（等待成交） | 股票=000632 | 价格=6.93元 | 手数=400

【持仓状态检查】股票：000632.SZ
 未找到目标持仓

[2025-11-20 09:28:09][新建策略文件][SH000300][1分钟] 
[买入流程] 002474.SZ | 目标价=11.32 | lots=200

【挂单操作】股票：002474.SZ
 挂单请求发送成功：002474.SZ | 价格11.32元 | 200手

[2025-11-20 09:28:12][新建策略文件][SH000300][1分钟] 
【委托状态检查】股票：002474.SZ
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM889942
 委托校验通过 | 委托ID=MM889942 | 状态=已报（等待成交） | 股票=002474 | 价格=11.32元 | 手数=200

【持仓状态检查】股票：002474.SZ
 未找到目标持仓

[2025-11-20 09:28:13][新建策略文件][SH000300][1分钟] 【竞价买入】所有股票买入流程结束

---

# 11月28日

## 日志


[2025-11-28 09:24:37][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-11-28 09:24:37][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-11-28 09:24:37
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 卖出规则：次日9:30开盘价×1.091挂单，14:55未卖撤单，14:57跌停价卖出
================================================================================

[2025-11-28 09:25:00][新建策略文件][SH000300][1分钟] [TIMER] timer_morning_sell fired

========================================
早盘卖出流程启动  时间：09:25:00
========================================

【查询当前持仓】账号：904800028165
 当前持仓：['000859.SZ', '301638.SZ']（共2只）
【早盘卖出】000859.SZ 基准价=8.47 * 1.091 -> 卖出价=9.24元

【卖出挂单】股票：000859.SZ | 价格=9.24元 | 股数=900
【获取最新委托ID】账号：904800028165
 未获取到最新委托ID（返回值：-1）
 卖出挂单成功，但未获取到委托ID
【早盘卖出】301638.SZ 基准价=25.75 * 1.191 -> 卖出价=30.66元

【卖出挂单】股票：301638.SZ | 价格=30.66元 | 股数=300
【获取最新委托ID】账号：904800028165
 未获取到最新委托ID（返回值：-1）
 卖出挂单成功，但未获取到委托ID
【早盘卖出】批量挂单结束

[2025-11-28 09:27:30][新建策略文件][SH000300][1分钟] [TIMER] timer_auction_buy fired

========================================
竞价买入流程启动  时间：09:27:30
========================================

【MongoDB查询】时间：2025-11-28 09:27:30（重试1/18）

[2025-11-28 09:27:35][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fa821c85d8bff8680528, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:27:45][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:27:45（重试2/18）

[2025-11-28 09:27:50][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fa911c85d8bff8680529, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:28:00][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:28:00（重试3/18）

[2025-11-28 09:28:05][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928faa01c85d8bff868052a, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:28:15][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:28:15（重试4/18）

[2025-11-28 09:28:21][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928faaf1c85d8bff868052b, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:28:31][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:28:31（重试5/18）

[2025-11-28 09:28:36][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fabf1c85d8bff868052c, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:28:46][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:28:46（重试6/18）

[2025-11-28 09:28:51][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928face1c85d8bff868052d, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:29:01][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:29:01（重试7/18）

[2025-11-28 09:29:06][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fadd1c85d8bff868052e, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:29:16][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:29:16（重试8/18）

[2025-11-28 09:29:22][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928faec1c85d8bff868052f, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:29:32][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:29:32（重试9/18）

[2025-11-28 09:29:37][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fafc1c85d8bff8680530, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:29:47][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:29:47（重试10/18）

[2025-11-28 09:29:52][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fb0b1c85d8bff8680531, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:30:02][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:30:02（重试11/18）

[2025-11-28 09:30:08][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fb1a1c85d8bff8680532, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:30:18][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:30:18（重试12/18）

[2025-11-28 09:30:23][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fb2a1c85d8bff8680533, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:30:33][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:30:33（重试13/18）

[2025-11-28 09:30:38][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fb391c85d8bff8680534, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:30:48][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:30:48（重试14/18）

[2025-11-28 09:30:54][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fb481c85d8bff8680535, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:31:04][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:31:04（重试15/18）

[2025-11-28 09:31:09][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fb581c85d8bff8680536, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:31:19][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:31:19（重试16/18）

[2025-11-28 09:31:24][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fb671c85d8bff8680537, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:31:34][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:31:34（重试17/18）

[2025-11-28 09:31:39][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fb761c85d8bff8680538, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:31:49][新建策略文件][SH000300][1分钟] 
【MongoDB查询】时间：2025-11-28 09:31:49（重试18/18）

[2025-11-28 09:31:55][新建策略文件][SH000300][1分钟] 获取股票篮子失败：No servers found yet, Timeout: 5.0s, Topology Description: <TopologyDescription id: 6928fb851c85d8bff8680539, topology_type: Single, servers: [<ServerDescription ('192.168.1.142', 27017) server_type: Unknown, rtt: None>]>，10秒后重试

[2025-11-28 09:32:05][新建策略文件][SH000300][1分钟] 所有重试失败，未找到今日股票篮子
【竞价买入】MongoDB 未返回股票篮子，本日不再尝试

[2025-11-28 09:35:00][新建策略文件][SH000300][1分钟] [TIMER] timer_cancel_auction_buys fired

========================================
竞价买入撤单流程启动  时间：09:35:00
========================================
【竞价撤单】今日无策略竞价买入记录，跳过

[2025-11-28 14:56:00][新建策略文件][SH000300][1分钟] [TIMER] timer_cancel_open_sells fired

========================================
14:55 撤销卖出委托流程  时间：14:56:00
========================================

【查询当前持仓】账号：904800028165
 当前持仓：['000859.SZ', '301638.SZ']（共2只）
【撤单】准备撤单 | code=301638 | opt=限价卖出 | status=50 | order_id=MM944923
can_cancel: True

【撤销委托】股票：301638 | 委托ID=MM944923
 委托撤销成功
【撤单】准备撤单 | code=000859 | opt=限价卖出 | status=50 | order_id=MM944924
can_cancel: True

【撤销委托】股票：000859 | 委托ID=MM944924
 委托撤销成功
【撤单】尾盘撤单流程完成

[2025-11-28 14:57:00][新建策略文件][SH000300][1分钟] [TIMER] timer_afternoon_sell fired

========================================
尾盘卖出流程启动  时间：14:57:00
========================================

【查询当前持仓】账号：904800028165
 当前持仓：['000859.SZ', '301638.SZ']（共2只）

【计算涨跌停价】股票：000859.SZ
 前收盘价=8.47元 | 涨停价=9.31元 | 跌停价=7.63元

【卖出挂单】股票：000859.SZ | 价格=7.63元 | 股数=900
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM636103
 卖出挂单成功 | 委托ID=MM636103
【尾盘卖出】000859.SZ 挂单 | 跌停价=7.63元 | 股数=900

【计算涨跌停价】股票：301638.SZ
 前收盘价=25.75元 | 涨停价=28.32元 | 跌停价=23.18元

【卖出挂单】股票：301638.SZ | 价格=23.18元 | 股数=300
【获取最新委托ID】账号：904800028165
 成功获取最新委托ID：MM636103
 卖出挂单成功 | 委托ID=MM636103
【尾盘卖出】301638.SZ 挂单 | 跌停价=23.18元 | 股数=300
【尾盘卖出】批量挂单完成

## 问题
1. mongodb的链接是局域网，在我的台式机上无法连接，导致股票获取失败；



--- 

# 12月1日

## 日志

[2025-12-01 09:08:23][新建策略文件][SH000300][1分钟] [trade]start trading mode
[2025-12-01 09:08:23][新建策略文件][SH000300][1分钟] ================================================================================
【实盘买入策略启动】时间：2025-12-01 09:08:23
配置信息：
  - MongoDB：192.168.1.142:27017/?authSource=stock/stock/ths_realtime_stocks
  - 交易账号：904800028165
  - 买入规则：竞价价×1.02（向下取整），资金均分
  - 卖出规则：次日9:30开盘价×1.091挂单，14:55未卖撤单，14:57跌停价卖出
================================================================================

[2025-12-01 09:25:00][新建策略文件][SH000300][1分钟] [TIMER] timer_morning_sell fired

========================================
早盘卖出流程启动  时间：09:25:00
========================================

【查询当前持仓】账号：904800028165
 当前持仓：['301638.SZ']（共1只）
【早盘卖出】301638.SZ 基准价=24.72 * 1.191 -> 卖出价=29.44元

【卖出挂单】股票：301638.SZ | 价格=29.44元 | 股数=300
【获取最新委托ID】账号：904800028165
 未获取到最新委托ID（返回值：-1）
 卖出挂单成功，但未获取到委托ID
【早盘卖出】批量挂单结束

## 问题

1. 早盘卖出挂单，未获取到委托id
2. 更改了选票策略的地址：
    1. 改为118.xxx的公网IP；
    2. 改为daily_stocks的数据库；
``` python
    # 原始用户名和密码（可能包含特殊字符）
    remote_username = "zheng123"  # 替换为实际用户名
    remote_password = "Jack@1357"  # 替换为实际密码（可能包含@、:等特殊字符）

    # 替换为实际的用户名和密码
    cloud_collection = MongoClient(
        f'mongodb://{encoded_username}:{encoded_password}@118.196.11.76:27017/',
        serverSelectionTimeoutMS=5000
    )['stock']['daily_stocks']


    # 对用户名和密码进行URL编码
    encoded_username = quote_plus(remote_username)
    encoded_password = quote_plus(remote_password)
```
