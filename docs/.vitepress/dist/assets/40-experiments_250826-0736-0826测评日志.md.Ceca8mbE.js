import{_ as a,c as t,o,ag as l}from"./chunks/framework.CQuhCYrb.js";const u=JSON.parse('{"title":"0826测评日志","description":"","frontmatter":{"title":"0826测评日志","created":"2025-09-07 17:00","updated":"2025-09-07T00:00:00.000Z","origin":"week-35","type":"experiment","status":"draft","tags":[],"links":[]},"headers":[],"relativePath":"40-experiments/250826-0736-0826测评日志.md","filePath":"40-experiments/250826-0736-0826测评日志.md"}'),r={name:"40-experiments/250826-0736-0826测评日志.md"};function i(n,e,d,c,s,h){return o(),t("div",null,[...e[0]||(e[0]=[l('<h2 id="exp-config-meta-把下块注释贴进你的配置文件顶部" tabindex="-1">EXP CONFIG META（把下块注释贴进你的配置文件顶部） <a class="header-anchor" href="#exp-config-meta-把下块注释贴进你的配置文件顶部" aria-label="Permalink to &quot;EXP CONFIG META（把下块注释贴进你的配置文件顶部）&quot;">​</a></h2><h1 id="" tabindex="-1">====================================================================== <a class="header-anchor" href="#" aria-label="Permalink to &quot;======================================================================&quot;">​</a></h1><h1 id="exp-config-meta-paste-at-top-of-your-yaml-toml-ini-config-file" tabindex="-1">EXP CONFIG META (paste at top of your .yaml / .toml / .ini config file) <a class="header-anchor" href="#exp-config-meta-paste-at-top-of-your-yaml-toml-ini-config-file" aria-label="Permalink to &quot;EXP CONFIG META (paste at top of your .yaml / .toml / .ini config file)&quot;">​</a></h1><h1 id="-1" tabindex="-1">---------------------------------------------------------------------- <a class="header-anchor" href="#-1" aria-label="Permalink to &quot;----------------------------------------------------------------------&quot;">​</a></h1><h1 id="exp-id-lt-exp-yyyymmdd-x-e-g-exp-20250903-a" tabindex="-1">EXP_ID : &lt;exp_yyyymmdd_x&gt; # e.g., exp_20250903_A <a class="header-anchor" href="#exp-id-lt-exp-yyyymmdd-x-e-g-exp-20250903-a" aria-label="Permalink to &quot;EXP_ID      : &amp;lt;exp_yyyymmdd_x&gt;          # e.g., exp_20250903_A&quot;">​</a></h1><h1 id="title-lt-short-one-liner-e-g-5l-transencoder-metaquery-256-no-decouple-lr×5" tabindex="-1">TITLE : &lt;short one-liner&gt; # e.g., 5L transencoder, metaquery=256(no-decouple), LR×5 <a class="header-anchor" href="#title-lt-short-one-liner-e-g-5l-transencoder-metaquery-256-no-decouple-lr×5" aria-label="Permalink to &quot;TITLE       : &amp;lt;short one-liner&gt;         # e.g., 5L transencoder, metaquery=256(no-decouple), LR×5&quot;">​</a></h1><h1 id="purpose-lt-what-this-config-is-testing-ablation" tabindex="-1">PURPOSE : &lt;what this config is testing/ablation&gt; <a class="header-anchor" href="#purpose-lt-what-this-config-is-testing-ablation" aria-label="Permalink to &quot;PURPOSE     : &amp;lt;what this config is testing/ablation&gt;&quot;">​</a></h1><h1 id="key-diffs-lt-the-2–4-knobs-that-distinguish-this-config-from-baseline" tabindex="-1">KEY_DIFFS : &lt;the 2–4 knobs that distinguish this config from baseline&gt; <a class="header-anchor" href="#key-diffs-lt-the-2–4-knobs-that-distinguish-this-config-from-baseline" aria-label="Permalink to &quot;KEY_DIFFS   : &amp;lt;the 2–4 knobs that distinguish this config from baseline&gt;&quot;">​</a></h1><h1 id="dataset-lt-e-g-24m-t2i" tabindex="-1">DATASET : &lt;e.g., 24M t2i&gt; <a class="header-anchor" href="#dataset-lt-e-g-24m-t2i" aria-label="Permalink to &quot;DATASET     : &amp;lt;e.g., 24M t2i&gt;&quot;">​</a></h1><h1 id="hardware-lt-e-g-a100×64" tabindex="-1">HARDWARE : &lt;e.g., A100×64&gt; <a class="header-anchor" href="#hardware-lt-e-g-a100×64" aria-label="Permalink to &quot;HARDWARE    : &amp;lt;e.g., A100×64&gt;&quot;">​</a></h1><h1 id="branch-commit-lt-wyq-dev-abc1234-optional" tabindex="-1">BRANCH/COMMIT: &lt;wyq_dev / abc1234&gt; # optional <a class="header-anchor" href="#branch-commit-lt-wyq-dev-abc1234-optional" aria-label="Permalink to &quot;BRANCH/COMMIT: &amp;lt;wyq_dev / abc1234&gt;      # optional&quot;">​</a></h1><h1 id="core-params-lr-batch-res-seed" tabindex="-1">CORE PARAMS : lr=&lt;...&gt;, batch=&lt;...&gt;, res=&lt;...&gt;, seed=&lt;...&gt; <a class="header-anchor" href="#core-params-lr-batch-res-seed" aria-label="Permalink to &quot;CORE PARAMS : lr=&lt;...&gt;, batch=&lt;...&gt;, res=&lt;...&gt;, seed=&lt;...&gt;&quot;">​</a></h1><h1 id="tags-lt-ablation-lt-lrx5-5l-lt-no-decouple-optional" tabindex="-1">TAGS : [&lt;ablation&gt;, &lt;lrx5&gt;, &lt;5L&gt;, &lt;no-decouple&gt;] # optional <a class="header-anchor" href="#tags-lt-ablation-lt-lrx5-5l-lt-no-decouple-optional" aria-label="Permalink to &quot;TAGS        : [&amp;lt;ablation&gt;, &amp;lt;lrx5&gt;, &lt;5L&gt;, &amp;lt;no-decouple&gt;]   # optional&quot;">​</a></h1><h1 id="notes-lt-any-caveat-e-g-warmup↑-grad-clip-needed-etc" tabindex="-1">NOTES : &lt;any caveat, e.g., warmup↑, grad_clip needed, etc.&gt; <a class="header-anchor" href="#notes-lt-any-caveat-e-g-warmup↑-grad-clip-needed-etc" aria-label="Permalink to &quot;NOTES       : &amp;lt;any caveat, e.g., warmup↑, grad_clip needed, etc.&gt;&quot;">​</a></h1><h1 id="-2" tabindex="-1">====================================================================== <a class="header-anchor" href="#-2" aria-label="Permalink to &quot;======================================================================&quot;">​</a></h1><h2 id="目标" tabindex="-1">目标 <a class="header-anchor" href="#目标" aria-label="Permalink to &quot;目标&quot;">​</a></h2><ul><li></li></ul><h2 id="设置-与基线的差异" tabindex="-1">设置（与基线的差异） <a class="header-anchor" href="#设置-与基线的差异" aria-label="Permalink to &quot;设置（与基线的差异）&quot;">​</a></h2><ul><li>数据/分辨率/学习率/权重 等关键改动（≤4 条）</li></ul><h2 id="指标与记录-训练-推理" tabindex="-1">指标与记录（训练/推理） <a class="header-anchor" href="#指标与记录-训练-推理" aria-label="Permalink to &quot;指标与记录（训练/推理）&quot;">​</a></h2><ul><li>&lt;iters&gt; / &lt;metric: value&gt;</li><li>&lt;样例路径或截图&gt;</li></ul><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><ul><li>&lt;保留/否决/待复验&gt;</li></ul><h2 id="下一步" tabindex="-1">下一步 <a class="header-anchor" href="#下一步" aria-label="Permalink to &quot;下一步&quot;">​</a></h2><ul><li></li></ul><h2 id="raw-notes" tabindex="-1">Raw Notes <a class="header-anchor" href="#raw-notes" aria-label="Permalink to &quot;Raw Notes&quot;">​</a></h2><p>下面是今天的开发日志（精简版）：</p><h1 id="_2025-08-26-开发日志" tabindex="-1">2025-08-26 开发日志 <a class="header-anchor" href="#_2025-08-26-开发日志" aria-label="Permalink to &quot;2025-08-26 开发日志&quot;">​</a></h1><ul><li><h2 id="评测接口适配" tabindex="-1">评测接口适配 <a class="header-anchor" href="#评测接口适配" aria-label="Permalink to &quot;评测接口适配&quot;">​</a></h2><ul><li><strong>问题</strong>：<code>generate</code> 被评测脚本调用时出现 <code>generator</code> 未定义；cond/uncond 拼批逻辑与返回张量需对齐脚本。</li><li><strong>处理</strong>：统一本地变量 <code>gen</code> 并显式传入采样；仅输出前半 <strong>cond</strong> 批的结果；保持输出为 <code>[-1,1]</code>、<code>[B,3,H,W]</code>。</li></ul></li><li><h2 id="与训练一致的-ae-解码链路" tabindex="-1">与训练一致的 AE/解码链路 <a class="header-anchor" href="#与训练一致的-ae-解码链路" aria-label="Permalink to &quot;与训练一致的 AE/解码链路&quot;">​</a></h2><ul><li><strong>问题</strong>：推理最初调用了 <code>pixels_to_latents/latents_to_pixels</code>，但训练用的是 <code>self.autoencoder</code> 的 <strong>encode_moments → FM → sample → decode</strong>。</li><li><strong>处理</strong>：推理改为：<code>encode_moments</code> 确定目标分布/形状 → ODE 积分得到 latent → <strong><code>self.autoencoder.sample(latent)</code></strong> → <strong><code>self.autoencoder.decode(z)</code></strong> 得到图像，完全对齐训练路径。</li></ul></li><li><h2 id="初态映射-zproj-to-latent" tabindex="-1">初态映射（_zproj_to_latent） <a class="header-anchor" href="#初态映射-zproj-to-latent" aria-label="Permalink to &quot;初态映射（\\_zproj\\_to\\_latent）&quot;">​</a></h2><ul><li><strong>问题</strong>：无条件引入随机初始化的线性投影会造成<strong>分布漂移</strong>。</li><li><strong>处理</strong>：<strong>优先 reshape</strong>（<code>z_text → [B,C,Hh,Ww]</code>）；仅当维度不匹配时才临时线性映射兜底，并提示风险。</li></ul></li><li><h2 id="log-snr-维度对齐" tabindex="-1"><code>log_snr</code> 维度对齐 <a class="header-anchor" href="#log-snr-维度对齐" aria-label="Permalink to &quot;`log_snr` 维度对齐&quot;">​</a></h2><ul><li><strong>问题</strong>：<code>fm_transformers</code> 断言 <code>log_snr.dim()==1</code>，之前传入了 <code>[B,1]</code>/<code>[B,1,1,1]</code>。</li><li><strong>处理</strong>：推理时显式构造一维 <code>log_snr</code>：<code>torch.full((B,), 4-8*t_k, ...)</code>；CFG 拼批时用 <code>torch.full((2*B,), ...)</code>。</li></ul></li><li><h2 id="时间采样-与训练分布一致且数值稳定" tabindex="-1">时间采样（与训练分布一致且数值稳定） <a class="header-anchor" href="#时间采样-与训练分布一致且数值稳定" aria-label="Permalink to &quot;时间采样（与训练分布一致且数值稳定）&quot;">​</a></h2><ul><li><strong>问题</strong>：逐步随机 <code>t</code> 不利于 ODE 连续积分与复现。</li><li><strong>处理</strong>：采用 <strong>logit-normal 分位点时间网格</strong>：用 Normal 的 <code>icdf</code> 得到 <code>z_edges</code> → <code>t_edges=sigmoid(z_edges)</code>，取中点 <code>t_mid</code>，步长 <code>dt = diff(t_edges)</code>；每步 <code>log_snr = 4 - 8 * t_mid[k]</code>（一维向量）。</li></ul></li><li><h2 id="推理时使用-null-indicator-cfg" tabindex="-1">推理时使用 <code>null_indicator</code>（CFG） <a class="header-anchor" href="#推理时使用-null-indicator-cfg" aria-label="Permalink to &quot;推理时使用 `null_indicator`（CFG）&quot;">​</a></h2><ul><li><strong>问题</strong>：如何在推理侧做 CFG 且保持维度正确。</li><li><strong>处理</strong>：<strong>速度域 CFG</strong>：拼接 <code>x_cat=[x_cond; x_cond]</code>，构造一维 <code>log_snr</code>（长度 <code>2B</code>），<code>null_indicator[B:]=True</code> 表示 uncond；得到 <code>v_cond/v_uncond</code> 后按 <code>v=(1+w)v_cond - w v_uncond</code> 合成，再更新 <strong><code>x</code></strong>。避免与“初态混合”CFG叠加。</li></ul></li><li><h2 id="解码变量明确" tabindex="-1">解码变量明确 <a class="header-anchor" href="#解码变量明确" aria-label="Permalink to &quot;解码变量明确&quot;">​</a></h2><ul><li><strong>结论</strong>：<strong>解码的就是积分后的 <code>x</code>（条件批 latent）</strong>；不要把 <code>x_cat</code> 或 <code>v_all</code> 送解码器。</li></ul></li><li><h2 id="形状确认" tabindex="-1">形状确认 <a class="header-anchor" href="#形状确认" aria-label="Permalink to &quot;形状确认&quot;">​</a></h2><ul><li><strong>观测</strong>：<code>(1,3,256,256) → (1,32,8,8)</code>，即 <code>latent_channels=32</code>、下采样因子 <code>32</code>；512 分辨率对应展平维度 <code>8192</code>。评测/训练尽量统一分辨率，避免频繁重建映射层。</li></ul></li></ul><p><strong>下一步建议</strong>：小网格搜索 <code>cfg_scale∈{0,2,3,4.5,6}</code>；固定评测分辨率；为 <code>log_snr</code>/<code>null_indicator</code>/时间网格加断言单测，确保形状与数值一致。</p>',30)])])}const m=a(r,[["render",i]]);export{u as __pageData,m as default};
