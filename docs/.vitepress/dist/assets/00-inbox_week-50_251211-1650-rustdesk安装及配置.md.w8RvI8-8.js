import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.OaOo95RB.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"00-inbox/week-50/251211-1650-rustdesk安装及配置.md","filePath":"00-inbox/week-50/251211-1650-rustdesk安装及配置.md"}'),t={name:"00-inbox/week-50/251211-1650-rustdesk安装及配置.md"};function e(h,s,p,k,d,o){return n(),a("div",null,[...s[0]||(s[0]=[l(`<ol><li><p>下载并安装Rustdesk客户端：</p><ul><li><a href="https://github.com/rustdesk/rustdesk/releases/tag/1.4.4" target="_blank" rel="noreferrer">download</a></li></ul></li><li><p>配置中继服务器</p><ul><li>Rustdesk客户端中：点击右上角的&quot;三&quot;进入设置，点击“网络”，点击“ID/中继服务器“，输入以下内容： <ul><li>ID服务器：118.196.11.76</li><li>中继服务器空置；</li><li>API服务器空置；</li><li>Key中输入“7whLYzxd2yXYG9VgoNqPVYSFx7pihuoq5nnt1yCjKG8=”</li></ul></li></ul></li><li><p>远程控制5090</p><ul><li>493 287 946</li><li>Jack@123</li></ul></li></ol><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;"># 用 RustDesk 自建远程桌面服务：从 0 搭建到流畅使用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">这篇博客记录一下我自己搭建 RustDesk 远程桌面服务的全过程：  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">后端用一台公网 Ubuntu 服务器跑 RustDesk Server（hbbs/hbbr），前端用 Windows + mac 客户端访问。  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">最后顺手也把画面很卡、FPS 很低的调优过程整理了一下。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 1. 场景与目标</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;"> **目标**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：不依赖官方服务器，完全使用自己的公网服务器作为 RustDesk 中转 / 信令，实现：</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 在任何地方远程控制家里的 Windows / 办公电脑；</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 连接稳定、延迟可接受，画面尽量流畅。</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;"> **服务器环境**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 公网机器：Ubuntu 24.04</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 已安装 Docker</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 使用镜像：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\`rustdesk/rustdesk-server:1.1.14\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">（或 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\`:latest\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 2. RustDesk 自建服务架构小抄</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RustDesk 自建服务主要有两个进程：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \`hbbs\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：信令/ID 服务器  </span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 负责客户端注册 ID、NAT 测试、打洞等。</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \`hbbr\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：中继服务器  </span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 打洞失败时，通过中继转发画面流。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**推荐端口（开源版）**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hbbs（信令）：</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \`21115/TCP\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：NAT 类型测试</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \`21116/TCP + UDP\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：ID 注册、心跳、打洞、连接</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \`21118/TCP\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：Web 客户端（可选）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hbbr（中继）：</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \`21117/TCP\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：中继数据</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \`21119/TCP\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">：Web 中继（可选）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 3. 服务器端搭建（Ubuntu + Docker）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 3.1 创建数据目录</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">数据目录用于保存密钥、公钥和数据库（ID 信息）：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\`\`\`bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rustdesk/data</span></span></code></pre></div><h3 id="_3-2-启动-hbbs-id-服务器" tabindex="-1">3.2 启动 hbbs（ID 服务器） <a class="header-anchor" href="#_3-2-启动-hbbs-id-服务器" aria-label="Permalink to &quot;3.2 启动 hbbs（ID 服务器）&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hbbs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rustdesk/data:/root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -td</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --net=host</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unless-stopped</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  rustdesk/rustdesk-server:1.1.14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hbbs</span></span></code></pre></div><p>关键点：</p><ul><li><code>--net=host</code>：让容器直接使用宿主机网络，不用再做端口映射。</li><li><code>-v /opt/rustdesk/data:/root</code>：把密钥等数据持久化到宿主机。</li></ul><h3 id="_3-3-启动-hbbr-中继服务器" tabindex="-1">3.3 启动 hbbr（中继服务器） <a class="header-anchor" href="#_3-3-启动-hbbr-中继服务器" aria-label="Permalink to &quot;3.3 启动 hbbr（中继服务器）&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hbbr</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rustdesk/data:/root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -td</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --net=host</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unless-stopped</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  rustdesk/rustdesk-server:1.1.14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hbbr</span></span></code></pre></div><h3 id="_3-4-检查容器-端口监听" tabindex="-1">3.4 检查容器 + 端口监听 <a class="header-anchor" href="#_3-4-检查容器-端口监听" aria-label="Permalink to &quot;3.4 检查容器 + 端口监听&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 容器是否在运行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 端口监听情况</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -lntup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2111</span></span></code></pre></div><p>理想情况下应看到类似输出：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>LISTEN ... 0.0.0.0:21115 ... hbbs</span></span>
<span class="line"><span>LISTEN ... 0.0.0.0:21116 ... hbbs</span></span>
<span class="line"><span>LISTEN ... 0.0.0.0:21117 ... hbbr</span></span>
<span class="line"><span>LISTEN ... 0.0.0.0:21118 ... hbbs</span></span>
<span class="line"><span>LISTEN ... 0.0.0.0:21119 ... hbbr</span></span></code></pre></div><p>说明服务在宿主机上成功监听端口。</p><hr><h2 id="_4-从日志中获取-key-公钥" tabindex="-1">4. 从日志中获取 Key（公钥） <a class="header-anchor" href="#_4-从日志中获取-key-公钥" aria-label="Permalink to &quot;4. 从日志中获取 Key（公钥）&quot;">​</a></h2><p>RustDesk 客户端连接自建服务器需要一个 <code>Key</code>（服务器公钥）。</p><h3 id="_4-1-从日志里直接查看" tabindex="-1">4.1 从日志里直接查看 <a class="header-anchor" href="#_4-1-从日志里直接查看" aria-label="Permalink to &quot;4.1 从日志里直接查看&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hbbs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Key&quot;</span></span></code></pre></div><p>可以看到类似：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INFO ... Key: 7whLYzxd2yXYG9VgoNqPVYSFx7pihuoq5nnt1yCjKG8=</span></span></code></pre></div><blockquote><p><code>=</code> 之前那一整串就是要填到客户端里的 Key。</p></blockquote><h3 id="_4-2-从公钥文件读取" tabindex="-1">4.2 从公钥文件读取 <a class="header-anchor" href="#_4-2-从公钥文件读取" aria-label="Permalink to &quot;4.2 从公钥文件读取&quot;">​</a></h3><p>公钥文件默认生成在数据目录：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rustdesk/data/id_ed25519.pub</span></span></code></pre></div><p>输出示例：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>7whLYzxd2yXYG9VgoNqPVYSFx7pihuoq5nnt1yCjKG8=</span></span></code></pre></div><p>复制 <strong>整行内容</strong>，不要带多余的 shell 提示符。</p><hr><h2 id="_5-云服务器安全组配置与验证" tabindex="-1">5. 云服务器安全组配置与验证 <a class="header-anchor" href="#_5-云服务器安全组配置与验证" aria-label="Permalink to &quot;5. 云服务器安全组配置与验证&quot;">​</a></h2><p>很多连接失败都卡在<strong>安全组没放行端口</strong>。</p><h3 id="_5-1-入站规则建议" tabindex="-1">5.1 入站规则建议 <a class="header-anchor" href="#_5-1-入站规则建议" aria-label="Permalink to &quot;5.1 入站规则建议&quot;">​</a></h3><p>对于绑定公网 IP 的那块网卡，对应安全组的 <strong>入向规则</strong> 建议：</p><table tabindex="0"><thead><tr><th>协议</th><th>端口范围</th><th>源地址</th><th>说明</th></tr></thead><tbody><tr><td>TCP</td><td>21115-21119</td><td>0.0.0.0/0</td><td>hbbs + hbbr</td></tr><tr><td>UDP</td><td>21116</td><td>0.0.0.0/0</td><td>hbbs 打洞</td></tr><tr><td>TCP</td><td>22</td><td>0.0.0.0/0</td><td>SSH（已有即可）</td></tr></tbody></table><p>常见坑：有的云厂商默认规则写成“源地址：本安全组”，这只允许安全组<strong>内部机器互访</strong>，外部网络（家里、办公室）是访问不了的，要改成 <code>0.0.0.0/0</code> 或指定 IP 段。</p><h3 id="_5-2-出站规则" tabindex="-1">5.2 出站规则 <a class="header-anchor" href="#_5-2-出站规则" aria-label="Permalink to &quot;5.2 出站规则&quot;">​</a></h3><p>一般云厂商默认是全部放行，可以不用管。 如果有限制，也要确保：</p><ul><li><code>21115-21119/TCP</code>、<code>21116/UDP</code> 对外网可出；</li><li>或者直接 <code>ALL / 0.0.0.0/0</code>。</li></ul><h3 id="_5-3-用-nc-从外网测试端口" tabindex="-1">5.3 用 nc 从外网测试端口 <a class="header-anchor" href="#_5-3-用-nc-从外网测试端口" aria-label="Permalink to &quot;5.3 用 nc 从外网测试端口&quot;">​</a></h3><p>在本地电脑（例如 mac）上：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试 ssh，确认 IP 真的通</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -vz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> YOUR_SERVER_IP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试 hbbs / hbbr 端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -vz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> YOUR_SERVER_IP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 21116</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -vz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> YOUR_SERVER_IP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 21117</span></span></code></pre></div><ul><li>如果 22 通、21116/21117 不通，多半是安全组没放开；</li><li>修改安全组后，再测一遍直到 <code>succeeded</code> 为止。</li></ul><hr><h2 id="_6-客户端配置-windows-mac" tabindex="-1">6. 客户端配置（Windows / mac） <a class="header-anchor" href="#_6-客户端配置-windows-mac" aria-label="Permalink to &quot;6. 客户端配置（Windows / mac）&quot;">​</a></h2><h3 id="_6-1-安装-rustdesk-客户端" tabindex="-1">6.1 安装 RustDesk 客户端 <a class="header-anchor" href="#_6-1-安装-rustdesk-客户端" aria-label="Permalink to &quot;6.1 安装 RustDesk 客户端&quot;">​</a></h3><p>去 RustDesk 官网或 GitHub Releases 下载对应平台安装包：</p><ul><li>Windows：<code>.exe</code></li><li>macOS：<code>.dmg</code></li></ul><p>安装完成后启动即可。</p><h3 id="_6-2-配置-网络-network" tabindex="-1">6.2 配置“网络 / Network” <a class="header-anchor" href="#_6-2-配置-网络-network" aria-label="Permalink to &quot;6.2 配置“网络 / Network”&quot;">​</a></h3><ol><li><p>打开 RustDesk，点击左侧 <strong>设置 / Settings</strong>。</p></li><li><p>进入 <strong>网络 / Network</strong>。</p></li><li><p>点击右上角的小锁图标，授予管理员权限（Windows 可能会弹 UAC）。</p></li><li><p>填写自建服务器信息：</p><ul><li><p><strong>ID 服务器 / ID Server</strong>：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>YOUR_SERVER_IP</span></span></code></pre></div><blockquote><p>不写端口时默认用 21116。</p></blockquote></li><li><p><strong>中继服务器 / Relay Server</strong>：</p><p>可以先留空，让客户端自动从 ID 服务器获取； 或者写死：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>YOUR_SERVER_IP:21117</span></span></code></pre></div></li><li><p><strong>Key</strong>：</p><p>填前面拿到的那串公钥，例如：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>7whLYzxd2yXYG9VgoNqPVYSFx7pihuoq5nnt1yCjKG8=</span></span></code></pre></div></li></ul></li><li><p>保存后关闭再重启 RustDesk，等待几秒，看本机的 ID 是否正常出现。</p></li></ol><h3 id="_6-3-建立远程连接" tabindex="-1">6.3 建立远程连接 <a class="header-anchor" href="#_6-3-建立远程连接" aria-label="Permalink to &quot;6.3 建立远程连接&quot;">​</a></h3><ul><li><p>在被控端（例如公司 Windows）上：</p><ul><li>打开 RustDesk，保持在线。</li></ul></li><li><p>在控制端（自己的 mac）上：</p><ul><li>在“连接到伙伴 / ID”框里输入目标机器的 RustDesk ID；</li><li>点击连接，输入对方密码或确认，即可远控。</li></ul></li></ul><hr><h2 id="_7-画面卡顿-fps-低的优化方案" tabindex="-1">7. 画面卡顿 / FPS 低的优化方案 <a class="header-anchor" href="#_7-画面卡顿-fps-低的优化方案" aria-label="Permalink to &quot;7. 画面卡顿 / FPS 低的优化方案&quot;">​</a></h2><p>连接成功之后，默认画面质量不一定理想，尤其是走中继时可能只有个位数 FPS。下面是几条实测有效的优化建议。</p><h3 id="_7-1-会话内设置-调整图像质量与-fps" tabindex="-1">7.1 会话内设置：调整图像质量与 FPS <a class="header-anchor" href="#_7-1-会话内设置-调整图像质量与-fps" aria-label="Permalink to &quot;7.1 会话内设置：调整图像质量与 FPS&quot;">​</a></h3><p>在已经连上的远控窗口顶部工具栏中：</p><ol><li><p>点击显示设置图标（小显示器）。</p></li><li><p>把“图像质量 / Image quality”改成 <strong>自定义 / Custom</strong>。</p></li><li><p>调整滑块：</p><ul><li><strong>Quality</strong>：建议 70–90；</li><li><strong>FPS</strong>：拉到 <strong>30</strong> 或 <strong>60</strong>。</li></ul></li></ol><p>这一步对流畅度影响非常大。</p><h3 id="_7-2-客户端全局设置-默认显示参数" tabindex="-1">7.2 客户端全局设置：默认显示参数 <a class="header-anchor" href="#_7-2-客户端全局设置-默认显示参数" aria-label="Permalink to &quot;7.2 客户端全局设置：默认显示参数&quot;">​</a></h3><p>为了每次连接都默认高 FPS，可以在客户端全局设置：</p><ol><li><p>打开 RustDesk → <strong>设置 / Settings → 显示 / Display</strong>。</p></li><li><p>设置：</p><ul><li>默认图像质量：<code>Custom</code></li><li>自定义图像质量：<code>50–80</code></li><li>自定义 FPS：<code>30</code> 或 <code>60</code></li><li>默认编码器：先 <code>Auto</code>，不满意可以尝试 <code>AV1</code> 或 <code>H264</code> / <code>VP9</code>。</li></ul></li></ol><p>部分显卡 / CPU 对 H265 的硬件编码支持一般，换编码器有时能从 6–10 FPS 拉到 20+。</p><h3 id="_7-3-分辨率与缩放" tabindex="-1">7.3 分辨率与缩放 <a class="header-anchor" href="#_7-3-分辨率与缩放" aria-label="Permalink to &quot;7.3 分辨率与缩放&quot;">​</a></h3><p>如果远端是 2K/4K 显示器，编码压力和带宽需求会明显提高。</p><p>建议：</p><ul><li>在远端系统里把分辨率调到 <strong>1920×1080</strong>；</li><li>或者在 RustDesk 的显示菜单里设置缩放为 80%、70%，减少传输数据量。</li></ul><h3 id="_7-4-relay-vs-direct-中继-vs-直连" tabindex="-1">7.4 Relay vs Direct（中继 vs 直连） <a class="header-anchor" href="#_7-4-relay-vs-direct-中继-vs-直连" aria-label="Permalink to &quot;7.4 Relay vs Direct（中继 vs 直连）&quot;">​</a></h3><p>状态栏中有时会显示当前连接类型：</p><ul><li><code>Direct</code> / <code>P2P</code>： 两端直接互联，延迟和带宽都更好。</li><li><code>Relay</code>： 所有数据通过你的服务器转发，受服务器上下行带宽限制。</li></ul><p>如果两端本身都是家宽 / 宽带环境，而服务器是轻量云上行较低，走 relay 时的 FPS 会明显掉。 改进思路：</p><ul><li>尽量保证服务器有足够带宽（上行至少 10 Mbps 以上更稳）；</li><li>或者给两端搭一个 VPN（如 Tailscale），让 RustDesk 在 VPN 地址上直连。</li></ul><h3 id="_7-5-其他细节检查" tabindex="-1">7.5 其他细节检查 <a class="header-anchor" href="#_7-5-其他细节检查" aria-label="Permalink to &quot;7.5 其他细节检查&quot;">​</a></h3><ul><li><strong>避免 CPU/GPU 满载</strong> 打开任务管理器/活动监视器，看 RustDesk 的 CPU/GPU 占用是否爆表。</li><li><strong>关闭隐私模式测试</strong> 某些版本开启隐私模式时会显著降低帧率，遇到奇怪卡顿可以暂时关闭试试。</li></ul><hr><h2 id="_8-常见问题排查清单" tabindex="-1">8. 常见问题排查清单 <a class="header-anchor" href="#_8-常见问题排查清单" aria-label="Permalink to &quot;8. 常见问题排查清单&quot;">​</a></h2><p>最后给一个“踩坑 checklist”，遇到问题可以按顺序对照：</p><ol><li><p><strong>容器是否在运行？</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span></span></code></pre></div></li><li><p><strong>端口是否监听？</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -lntup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2111</span></span></code></pre></div></li><li><p><strong>安全组是否放行公网 IP？</strong></p><ul><li>入向规则中是否存在 <code>TCP 21115-21119</code>、<code>UDP 21116</code>，源地址为 <code>0.0.0.0/0</code>？</li></ul></li><li><p><strong>从外网 <code>nc</code> 是否能连上？</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -vz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> YOUR_SERVER_IP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 21116</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -vz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> YOUR_SERVER_IP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 21117</span></span></code></pre></div></li><li><p><strong>客户端 Network 设置是否正确？</strong></p><ul><li>ID Server：<code>YOUR_SERVER_IP</code></li><li>Relay：<code>YOUR_SERVER_IP:21117</code> 或留空</li><li>Key：与服务器 <code>id_ed25519.pub</code> 完全一致</li></ul></li><li><p><strong>画面卡顿时：</strong></p><ul><li>会话内设置是否切到 <code>Custom</code>，FPS 设为 30/60？</li><li>是否为高分辨率（2K/4K），是否尝试降低分辨率？</li><li>连接类型是 <code>Direct</code> 还是 <code>Relay</code>？</li></ul></li></ol><hr><h2 id="_9-小结" tabindex="-1">9. 小结 <a class="header-anchor" href="#_9-小结" aria-label="Permalink to &quot;9. 小结&quot;">​</a></h2><p>整套自建流程其实就三步：</p><ol><li><strong>服务器端</strong>：Docker 起 <code>hbbs</code> + <code>hbbr</code>，确认端口监听；</li><li><strong>云厂商安全组</strong>：把 21115–21119 TCP 和 21116 UDP 对公网放开；</li><li><strong>客户端</strong>：在 Network 中填好 <code>ID Server</code> / <code>Relay</code> / <code>Key</code>，在 Display 中调高 FPS 和画质。</li></ol><p>搭好之后，RustDesk 基本就是“自己的 AnyDesk/TeamViewer”， 既能穿透内网，又不依赖第三方服务器，适合长期远程维护自己的机器。</p><p>如果后续要做多用户共享、Web 客户端访问之类的，也可以在这个基础上继续扩展。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>::contentReference[oaicite:0]{index=0}</span></span></code></pre></div>`,84)])])}const g=i(t,[["render",e]]);export{c as __pageData,g as default};
